<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UniAgenda - Seus Agendamentos</title>
  <link rel="stylesheet" href="/static/css/home2.css">
  <link rel="shortcut icon" href="/static/favicon.ico" type="image/x-icon">
  <style>
    .hidden {
      display: none;
    }
    .blur-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      backdrop-filter: blur(5px);
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 999;
      display: none;
    }
    .popout {
      background-color: #F2F2F2;
      border: 3px solid black;
      border-radius: 50px;
      padding: 50px;
      text-align: center;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 25px;
      display: none;
      z-index: 1000;
    }
    .close-btn {
      position: absolute;
      font-size: 15px;
      top: 16px;
      right: 26px;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background-color: #1BA657;
      color: #F2F2F2;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .buttons {
      margin-top: 20px;
    }
    .btn-sim,
    .btn-nao {
      cursor: pointer;
      width: 100px;
      padding: 10px;
      background-color: #1BA657;
      font-size: 20px;
      border-radius: 50px;
      margin: 10px;
    }
    .btn-sim:hover,
    .btn-nao:hover {
      transform: translateY(2px);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }
    .btn-sim:active,
    .btn-nao:active {
      transform: translateY(0);
      box-shadow: none;
    }
    .close-btn:hover {
      padding: 1px;
    }
    .calendar-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
    }
    .day-cell {
      text-align: center;
      padding: 10px;
      border-radius: 50px;
      transition: background-color 0.3s;
    }
    .day-cell:hover {
      background-color: #f0f0f0;
      cursor: pointer;
    }
    .day-cell.prev-month, .day-cell.next-month {
      display: none;
    }
    .legend {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      text-align: center;
      font-weight: bold;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <header>
    <img style="height: 50px; padding-left: 10px;" src="/static/Group1.png" alt="logo">
    <a class="logout-btn" style="text-decoration: none;" href="/logout">Sair</a>
  </header>
  <main class="main-content" style="display: flex; justify-content: flex-start;">
    <section class="user-info">
      <div class="user-box">
        <img src="/static/userfotopadrao.png" alt="fotousuario">
        <h2 class="username">{{ session.capitalize() }}</h2>
        <h4 class="agenda">Sua Agenda</h4>
      </div>
      <div class="container1">
        {% if agendamentos %}
          <div class="agendamentos">
            {% for agendamento in agendamentos %}
              <div class="agendamento">
                <h3>{{ agendamento.laboratorio }}</h3>
                <div class="details">
                  <span class="hora">{{ agendamento.hora_inicio.strftime('%H:%M às') }} {{ agendamento.hora_fim.strftime('%H:%M') }}</span>
                  <span class="date">{{ agendamento.data.strftime('%d/%m/%Y') }}</span>
                  <span class="room">{{ agendamento.predio }}</span>
                  <form id="form-{{ agendamento.id }}" method="post" action="{{ url_for('excluir_agendamento', agendamento_id=agendamento.id) }}">
                    <button type="button" class="cancel-btn" onclick="confirmarExclusao({{ agendamento.id }})">Cancelar</button>
                  </form>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="agendavazia">Voce não possui nenhum agendamento.</p>
        {% endif %}
        <button type="button" class="new-appointment-btn" onclick="openAppointmentForm()">Novo Agendamento</button>
      </div>
    </section>
    <section class="calendar">
      <div class="container">
        <h2>Selecione uma data:</h2>
        <div class="calendar-nav">
          <button class="prev-month" onclick="changeMonth(-1)">&#10094;</button>
          <div class="current-month" id="currentMonth">Junho 2024</div>
          <button class="next-month" onclick="changeMonth(1)">&#10095;</button>
        </div>
        <div class="legend">
          <div>D</div>
          <div>S</div>
          <div>T</div>
          <div>Q</div>
          <div>Q</div>
          <div>S</div>
          <div>S</div>
        </div>
        <div class="calendar-grid"></div>
      </div>
      <div class="flash-messages"">
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="flash-message {{ category }}">
                {% if category == 'error' %}
                  <div class="erro">{{ message }}</div>
                {% else %}
                  <div>{{ message }}</div>
                {% endif %}
              </div>
            {% endfor %}
          {% endif %}
        {% endwith %}
      </div>
      <div class="appointment-form hidden" id="appointmentForm">
        <h2 class="title">Novo Agendamento</h2>
        <form method="post" action="/agendar">
              <label for="date">Data:</label>
              <input type="text" id="date" name="date" readonly>
          <div class="time-group">
            <div class="time-field">
              <label for="startTime">Hora de Início:</label>
              <input type="time" id="startTime" name="startTime">
            </div>
            <div class="time-field">
              <label for="endTime">Hora de Término:</label>
              <input type="time" id="endTime" name="endTime">
            </div>
          </div>
          <div class="building-location-group">
            <div class="building-field">
              <label for="building">Prédio:</label>
              <select id="building" name="building">
                {% for predio in predios %}
                  <option value="{{ predio }}">{{ predio }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="location-field">
              <label for="location">Sala / Laboratório:</label>
              <select id="location" name="location" required>
                {% for lab in labs %}
                  <option value="{{ lab }}">{{ lab }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          <button type="submit" class="submit-btn">Agendar</button>
        </form>
      </div>
    </section>
  </main>
  <div class="blur-overlay"></div>
  <div class="popout" id="popout">
    <span class="close-btn" onclick="closePopout()">X</span>
    <p>Gostaria de cancelar o agendamento?</p>
    <div class="buttons">
      <button class="btn-sim" onclick="confirmRemove()">Sim!</button>
      <button class="btn-nao" onclick="closePopout()">Não!</button>
    </div>
  </div>
  <script>
    let currentMonth = new Date().getMonth();
    let currentYear = new Date().getFullYear();

    document.addEventListener("DOMContentLoaded", function() {
      updateCalendar();
    });

    function updateCalendar() {
      const monthNames = [
        "Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho",
        "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"
      ];
      const currentMonthElement = document.getElementById("currentMonth");
      const calendarGrid = document.querySelector(".calendar-grid");
      calendarGrid.innerHTML = ""; // Limpar o calendário anterior

      currentMonthElement.textContent = `${monthNames[currentMonth]} ${currentYear}`;

      const firstDayOfMonth = new Date(currentYear, currentMonth, 1).getDay();
      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

      for (let i = 0; i < firstDayOfMonth; i++) {
        const emptyCell = document.createElement("div");
        calendarGrid.appendChild(emptyCell);
      }

      for (let day = 1; day <= daysInMonth; day++) {
        const dayCell = document.createElement("div");
        dayCell.className = "day-cell";
        dayCell.textContent = day;
        dayCell.onclick = () => openAppointmentForm(day);
        calendarGrid.appendChild(dayCell);
      }
    }

    function changeMonth(delta) {
      currentMonth += delta;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      } else if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      updateCalendar();
    }

    function openAppointmentForm(day) {
      const appointmentForm = document.getElementById("appointmentForm");
      const dateInput = document.getElementById("date");
      const monthNames = [
        "Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho",
        "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"
      ];

      dateInput.value = `${day} de ${monthNames[currentMonth]} de ${currentYear}`;
      appointmentForm.classList.remove("hidden");
    }

    function saveAppointment() {
      const appointmentForm = document.getElementById("appointmentForm");
      appointmentForm.classList.add("hidden");
      alert("Agendamento salvo!");
      // Adicionar lógica para salvar o agendamento
    }

    function confirmarExclusao(agendamentoId) {
      const popout = document.getElementById("popout");
      popout.style.display = "block";
      document.querySelector('.blur-overlay').style.display = 'block';
      agendamentoIdParaExcluir = agendamentoId;
    }

    function closePopout() {
      const popout = document.getElementById("popout");
      popout.style.display = "none";
      document.querySelector('.blur-overlay').style.display = 'none';
    }

    function confirmRemove() {
      if (agendamentoIdParaExcluir) {
        document.getElementById(`form-${agendamentoIdParaExcluir}`).submit();
      }
    }
  </script>
  <script src="/static/js/home2.js"></script>
</body>
</html>
